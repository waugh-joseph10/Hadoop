{"paragraphs":[{"text":"%pyspark\r\n\r\nfrom pyspark.sql import SparkSession\r\n\r\n# read data\r\n#data = spark.read.option(\"delimiter\", \"#\").csv('s3://s3awscisdata/data/ratings/ratings.t',inferSchema=True,header=True)\r\ndata = spark.read.csv('s3://s3awscisdata/data/ml-latest-small/ratings.csv',inferSchema=True,header=True)\r\ndata.show()\r\ndata.describe()","user":"jwaugh1","dateUpdated":"2019-04-24T20:14:00+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------+-------+------+---------+\n|userId|movieId|rating|timestamp|\n+------+-------+------+---------+\n|     1|      1|   4.0|964982703|\n|     1|      3|   4.0|964981247|\n|     1|      6|   4.0|964982224|\n|     1|     47|   5.0|964983815|\n|     1|     50|   5.0|964982931|\n|     1|     70|   3.0|964982400|\n|     1|    101|   5.0|964980868|\n|     1|    110|   4.0|964982176|\n|     1|    151|   5.0|964984041|\n|     1|    157|   5.0|964984100|\n|     1|    163|   5.0|964983650|\n|     1|    216|   5.0|964981208|\n|     1|    223|   3.0|964980985|\n|     1|    231|   5.0|964981179|\n|     1|    235|   4.0|964980908|\n|     1|    260|   5.0|964981680|\n|     1|    296|   3.0|964982967|\n|     1|    316|   3.0|964982310|\n|     1|    333|   5.0|964981179|\n|     1|    349|   4.0|964982563|\n+------+-------+------+---------+\nonly showing top 20 rows\n\nDataFrame[summary: string, userId: string, movieId: string, rating: string, timestamp: string]\n"}]},"apps":[],"jobName":"paragraph_1556049076375_1606594118","id":"20181204-011212_400165244","dateCreated":"2019-04-23T19:51:16+0000","dateStarted":"2019-04-23T19:51:35+0000","dateFinished":"2019-04-23T19:51:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1530"},{"text":"%pyspark\n\n# train test split\ntrain_data, test_data = data.randomSplit([0.8,0.2])","user":"jwaugh1","dateUpdated":"2019-04-24T20:14:00+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1556049076376_821749350","id":"20181204-012213_2094089887","dateCreated":"2019-04-23T19:51:16+0000","dateStarted":"2019-04-23T19:52:24+0000","dateFinished":"2019-04-23T19:52:24+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1531"},{"text":"%pyspark\n\n# instantiate model\nfrom pyspark.ml.recommendation import ALS\nals = ALS(maxIter=5,regParam=0.01,userCol='userId',itemCol='movieId',ratingCol='rating',coldStartStrategy='drop')","user":"jwaugh1","dateUpdated":"2019-04-24T20:14:00+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1556049076376_-301693718","id":"20181204-012619_1728530401","dateCreated":"2019-04-23T19:51:16+0000","dateStarted":"2019-04-23T19:52:44+0000","dateFinished":"2019-04-23T19:52:44+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1532"},{"text":"%pyspark\n\n# train\nals_model = als.fit(train_data)\n","user":"jwaugh1","dateUpdated":"2019-04-24T20:14:00+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1556049076376_691735986","id":"20181204-012952_1378888302","dateCreated":"2019-04-23T19:51:16+0000","dateStarted":"2019-04-23T19:53:43+0000","dateFinished":"2019-04-23T19:53:45+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1533"},{"text":"%pyspark\n\n# test\npredictions = als_model.transform(test_data)\npredictions.show()","user":"jwaugh1","dateUpdated":"2019-04-24T20:14:00+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------+-------+------+----------+----------+\n|userId|movieId|rating| timestamp|prediction|\n+------+-------+------+----------+----------+\n|   133|    471|   4.0| 843491793| 6.1192465|\n|   182|    471|   4.5|1054779644| 3.4649734|\n|   474|    471|   3.0| 974668858| 3.2392344|\n|   610|    471|   4.0|1479544381| 3.2038314|\n|   171|    471|   3.0| 866905683|  4.610401|\n|   216|    471|   3.0| 975212641|  3.876996|\n|   469|    471|   5.0| 965425364| 3.0912766|\n|   609|    833|   3.0| 847221080|   1.83359|\n|   159|   1088|   4.0|1508641161| 4.1748223|\n|   111|   1088|   3.0|1516153967|  2.683226|\n|   132|   1088|   4.0|1329984080|  3.032008|\n|   169|   1088|   4.5|1059427717| 4.2331495|\n|   554|   1088|   5.0| 944900489|   4.29545|\n|    10|   1088|   3.0|1455619275|  4.131431|\n|   221|   1088|   3.0|1111178147|  2.751738|\n|    68|   1088|   3.5|1158534614|  4.012663|\n|   517|   1088|   1.0|1487958398|   3.17272|\n|   325|   1238|   4.0|1039399025| 4.2707067|\n|    19|   1238|   3.0| 965705784| 3.6727474|\n|   469|   1238|   5.0| 965425364|  5.095398|\n+------+-------+------+----------+----------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1556049076376_-166123780","id":"20181204-013208_1109285287","dateCreated":"2019-04-23T19:51:16+0000","dateStarted":"2019-04-23T19:54:24+0000","dateFinished":"2019-04-23T19:54:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1534"},{"text":"%pyspark\n\n# evaluate\nfrom pyspark.ml.evaluation import RegressionEvaluator\nevaluator = RegressionEvaluator(metricName='rmse',labelCol='rating',predictionCol='prediction')\nrmse = evaluator.evaluate(predictions)\nrmse","user":"jwaugh1","dateUpdated":"2019-04-24T20:14:00+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"1.0766519490265127\n"}]},"apps":[],"jobName":"paragraph_1556049076376_-1483417064","id":"20181204-013505_1048229260","dateCreated":"2019-04-23T19:51:16+0000","dateStarted":"2019-04-23T19:54:41+0000","dateFinished":"2019-04-23T19:54:45+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1535"},{"text":"%pyspark\n\n# make predictions for single user\nsingle_user = test_data.filter(test_data['userId']==1).select(['movieId','userId'])\nsingle_user.show()\nrecommendations = als_model.transform(single_user)\nrecommendations.orderBy('prediction',ascending=False).show()","user":"jwaugh1","dateUpdated":"2019-04-24T20:14:00+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+------+\n|movieId|userId|\n+-------+------+\n|      6|     1|\n|     50|     1|\n|    157|     1|\n|    356|     1|\n|    457|     1|\n|    543|     1|\n|    590|     1|\n|    592|     1|\n|    648|     1|\n|    661|     1|\n|    943|     1|\n|   1032|     1|\n|   1042|     1|\n|   1196|     1|\n|   1222|     1|\n|   1224|     1|\n|   1226|     1|\n|   1270|     1|\n|   1275|     1|\n|   1282|     1|\n+-------+------+\nonly showing top 20 rows\n\n+-------+------+----------+\n|movieId|userId|prediction|\n+-------+------+----------+\n|   1224|     1| 5.8691683|\n|   2141|     1| 5.7749987|\n|   1032|     1|  5.321361|\n|   2959|     1| 5.1892633|\n|   1298|     1|  5.166007|\n|   2571|     1| 5.1159563|\n|    157|     1|  5.105344|\n|   1270|     1|  4.986825|\n|   1196|     1| 4.9839745|\n|   2797|     1|  4.978667|\n|     50|     1|  4.967977|\n|   3053|     1| 4.9416885|\n|   2478|     1| 4.8763304|\n|    356|     1|  4.875943|\n|   1275|     1| 4.8529506|\n|      6|     1|  4.784124|\n|   1222|     1| 4.7514205|\n|   1732|     1| 4.6414194|\n|   3793|     1| 4.6350317|\n|   2291|     1| 4.6055646|\n+-------+------+----------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1556049076377_2146525626","id":"20181204-013700_2102410801","dateCreated":"2019-04-23T19:51:16+0000","dateStarted":"2019-04-23T19:54:53+0000","dateFinished":"2019-04-23T19:55:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1536"}],"name":"Apache Spark Note","id":"2E95D9GSE","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}